sequenceDiagram
  participant U as User
  participant FE as Frontend
  participant BE as NestJS API
  participant DB as PostgreSQL
  participant AI as AI Providers

  U->>FE: Login(phone)
  FE->>BE: POST /auth/login
  BE->>DB: upsert User
  DB-->>BE: user_id
  BE-->>FE: login response

  U->>FE: Open lobby
  FE->>BE: POST /lobby/menu
  BE->>DB: create/update LobbySession + fetch themes
  DB-->>BE: lobby + themes
  BE-->>FE: prompt + digit map

  U->>FE: Select theme, start
  FE->>BE: POST /lobby/input/dtmf
  BE->>DB: end lobby + create GameSession
  BE->>AI: frame START prompt (optional)
  AI-->>BE: persona prompt
  BE-->>FE: active game session

  U->>FE: Request hints / submit guess
  FE->>BE: /game/input/dtmf or /game/guess
  BE->>DB: read/update GameSession, attributes, results
  BE->>AI: question/prompt framing (optional)
  AI-->>BE: generated text
  BE-->>FE: next state

  U->>FE: View leaderboard
  FE->>BE: ended menu -> leaderboard action
  BE->>DB: aggregate/rank GameResult
  DB-->>BE: top10 + user rank
  BE-->>FE: leaderboard payload
